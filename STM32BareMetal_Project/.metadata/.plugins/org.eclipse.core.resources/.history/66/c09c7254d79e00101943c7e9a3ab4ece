#include "timebase.h"
#include "stm32f4xx.h"

#define CTRL_ENABLE		(1U<<0)
#define CTRL_TICKINT	(1U<<1)
#define CTRL_CLCKSRC	(1U<<2)
#define CTRL_COUNTFLAG	(1U<<16)

#define ONE_SEC_LOAD	16000000


void timebase_init(void) {

	/**
	 * 初始化 systick 的步骤
	 * */

	// 1. 禁用全局中断
	__disable_irq();

	// 2. 用每秒的时钟周期数来加载计时器
	SysTick->LOAD = ONE_SEC_LOAD - 1;

	// 3. 清除 systick 当前值寄存器
	SysTick->VAL = 0;

	// 4. 选择内部时钟源
	SysTick->CTRL = CTRL_CLCKSRC;

	// 5. 启用中断


	// 6. 启用 systick


	// 7. 启用全局中断
	__enable_irq();
}

